<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Бронирование отелей</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8fafc;
      color: #1e293b;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
    }

    /* Фильтры */
    .filters {
      background: white;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 24px;
    }
    .filters h2 {
      margin-bottom: 12px;
      font-size: 1.1rem;
    }
    .filters label {
      display: inline-block;
      margin-right: 16px;
      margin-bottom: 8px;
    }

    /* Отели и номера */
    .hotel-section {
      margin-bottom: 40px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    .hotel-header {
      padding: 16px;
      background: #f1f5f9;
      font-weight: bold;
      font-size: 1.3rem;
    }
    .rooms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .room-card {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
    }
    .room-card h3 {
      margin-bottom: 6px;
      font-size: 1.1rem;
    }
    .room-card p {
      margin-bottom: 12px;
      color: #475569;
    }
    .room-card .price {
      font-weight: bold;
      color: #0ea5e9;
      margin-bottom: 12px;
    }
    .room-card a {
      display: inline-block;
      background: #0ea5e9;
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
    }
    .room-card a:hover {
      background: #0284c7;
    }
    .empty {
      text-align: center;
      padding: 40px;
      color: #94a3b8;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Бронирование отелей</h1>
    </header>

    <div class="filters">
      <h2>Удобства</h2>
      <div id="filters-container">
        <!-- Фильтры будут загружены сюда -->
      </div>
    </div>

    <div id="hotels-container">
      <!-- Отели и номера -->
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:8000'; // ← замените на ваш бэкенд

    let allHotels = [];
    let currentFilters = [];

    // Загрузка данных
    async function loadData() {
      try {
        // Загружаем отели и список удобств
        const [hotelsRes, optionsRes] = await Promise.all([
          fetch(`${API_BASE}/hotels`),
          fetch(`${API_BASE}/rooms/options`)
        ]);
        allHotels = await hotelsRes.json();
        const allOptions = await optionsRes.json();

        // Рендерим фильтры
        const filtersContainer = document.getElementById('filters-container');
        filtersContainer.innerHTML = allOptions.map(opt => `
          <label>
            <input type="checkbox" value="${opt}" onchange="onFilterChange()"> ${opt}
          </label>
        `).join('');

        // Загружаем номера
        loadRooms();
      } catch (err) {
        console.error('Ошибка загрузки данных:', err);
        document.getElementById('hotels-container').innerHTML = '<div class="empty">Ошибка загрузки</div>';
      }
    }

    async function loadRooms(options = []) {
      let url = `${API_BASE}/rooms`;
      if (options.length > 0) {
        const params = new URLSearchParams();
        options.forEach(opt => params.append('options', opt));
        url += '?' + params.toString();
      }

      try {
        const res = await fetch(url);
        const rooms = await res.json();

        // Группируем номера по отелю
        const grouped = {};
        rooms.forEach(room => {
          if (!grouped[room.hotel_id]) grouped[room.hotel_id] = [];
          grouped[room.hotel_id].push(room);
        });

        // Рендерим отели с номерами
        const container = document.getElementById('hotels-container');
        if (Object.keys(grouped).length === 0) {
          container.innerHTML = '<div class="empty">Номера не найдены</div>';
          return;
        }

        let html = '';
        for (const hotel of allHotels) {
          const hotelRooms = grouped[hotel.id] || [];
          if (hotelRooms.length === 0) continue;

          html += `<div class="hotel-section">
                    <div class="hotel-header">${hotel.name}</div>
                    <div class="rooms-grid">`;
          hotelRooms.forEach(room => {
            html += `
              <div class="room-card">
                <h3>${room.name || 'Номер'}</h3>
                <p>${room.description || 'Описание отсутствует'}</p>
                <div class="price">от ${room.price || '—'} ₽/ночь</div>
                <a href="booking.html?room_id=${room.id}">Забронировать</a>
              </div>`;
          });
          html += `</div></div>`;
        }
        container.innerHTML = html;
      } catch (err) {
        console.error('Ошибка загрузки номеров:', err);
        document.getElementById('hotels-container').innerHTML = '<div class="empty">Не удалось загрузить номера</div>';
      }
    }

    window.onFilterChange = function() {
      const checkboxes = document.querySelectorAll('#filters-container input[type="checkbox"]:checked');
      currentFilters = Array.from(checkboxes).map(cb => cb.value);
      loadRooms(currentFilters);
    };

    // Запуск
    loadData();
  </script>
</body>
</html>